<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--
`<vaadin-radio-group>` is a Polymer 2 element.

```html
<vaadin-radio-group>
</vaadin-radio-group>
```

@element vaadin-radio-group
@demo demo/index.html
-->

<link rel="import" href="vaadin-radio-button.html">

<dom-module id="vaadin-radio-group-default-theme" theme-for="vaadin-radio-group">
  <template>
    <style>
      :host {
        display: inline-block;
        outline: none;
      }

      [part="wrapper"] {
        display: inline-flex;
        align-items: center;
        outline: none;
      }

      :host([invalid]) [part="wrapper"] {
        box-shadow: 0 0 2px 2px highlight;
      }
    </style>
  </template>
</dom-module>

<dom-module id="vaadin-radio-group">
  <template>
  	<div part="wrapper" id="wrapper">
  		<slot></slot>
  	</div>

  </template>
  <script>
    if (!Polymer.Element) {
      throw new Error('Unexpected Polymer version ${Polymer.version} is used, expected v2.0.0 or later.');
    }

    (function() {

      class GroupRadioElement extends Vaadin.ThemableMixin(Polymer.Element) {
        static get is() {
          return 'vaadin-radio-group';
        }

        static get properties() {
          return {
            name: {
              type: String,
              reflectToAttribute: true
            },
            value: {
              type: String,
              notify: true,
              observer: '_activeValue',
              reflectToAttribute: true
            },
            required: {
              type: Boolean,
              reflectToAttribute: true
            },
            disabled: {
              type: Boolean,
              reflectToAttribute: true,
              observer: '_checkDisabled'
            }
          };
        }

        ready() {
          
          super.ready();

          this._addActiveListeners();

          this.addEventListener('radio-changed', e => {
            if(e.target.checked) {
              this.querySelectorAll('vaadin-radio-button').forEach((item) => item.checked = (e.target === item) ? true : false);
              this.value = e.target.value;
            }
          });

        }

        _checkDisabled(value) {

          if(value)
            this.removeAttribute('invalid');
          this.querySelectorAll('vaadin-radio-button').forEach((item) => item.disabled = value);

        }

        _addActiveListeners() {

          this.addEventListener('keydown', e => {
            if (!this.disabled && (e.keyCode === 37 || e.keyCode === 38)) {
              e.preventDefault();
              if(e.target.previousElementSibling) {
                e.target.previousElementSibling.checked = true;
                e.target.previousElementSibling.focus();
                this.value = e.target.previousElementSibling.value;
              } else {
                this.lastElementChild.checked = true;
                this.lastElementChild.focus();
                this.value = this.lastElementChild.value;
              }
            }
            if (!this.disabled && (e.keyCode === 39 || e.keyCode === 40)) {
              e.preventDefault();
              if(e.target.nextElementSibling) {
                e.target.nextElementSibling.checked = true;
                e.target.nextElementSibling.focus();
                this.value = e.target.nextElementSibling.value;
              } else {
                this.firstElementChild.checked = true;
                this.firstElementChild.focus();
                this.value = this.firstElementChild.value;
              }
            }
          });

        }

        _activeValue(set) {

          if(set)
            this.removeAttribute('invalid');
          this.querySelectorAll('vaadin-radio-button').forEach((item) => item.checked = false);
          if(this.querySelector('vaadin-radio-button[value="' + set + '"]'))
            this.querySelector('vaadin-radio-button[value="' + set + '"]').checked = true;

        }

        validate() {

          if(!this.value && this.required && !this.disabled) {
            this.setAttribute('invalid', '');
            return false;
          } else 
            return true;

        }
       
      }

      customElements.define(GroupRadioElement.is, GroupRadioElement);

      /**
       * @namespace Vaadin
       */
      window.Vaadin = window.Vaadin || {};
      Vaadin.GroupRadioElement = GroupRadioElement;
    })();
  </script>
</dom-module>